
\chapter{AsthmaBuddy}
\label{chp:our-solution}

\section{Background}
As mentioned in Chapter \ref{chp:background}; in 2012, we did a similar project using Karotz\fnurl{Karotz}{www.karotz.com} as the platform for the tangible user interface\cite{CustomerDriven}.
This project left us with mixed feelings towards Karotz as a platform. The thought behind Karotz is great. It is an open source robot which allows people to build applications and launch it to the Karotz store. However, in our subjective opinion, it is not ideal to work with. The Karotz starters kit costs ~\$200, not including customs. Thus it is a pretty large investment for a family wanting to use our application. The API is only documented in French, which makes it a hassle to develop on, in addition to the fact that it is pretty cumbersome to configure for a ``non-technological'' family. 

We researched other options than Karotz to create our tangible user interface. The alternatives we looked into was Arduino and Raspberry Pi. Arduino is an open source electronics prototyping platform\cite{arduino}, which allows for many different combinations of configurations. Arduino shields comes in many shapes and sizes and is built for modularity and extendability. A wide-range of components are available if you want to add technical functionality to an Arduino system, such as Bluetooth, WiFi or small motors. 
While Arduino allows complex hardware configurations, Raspberry Pi makes larger abstractions, which seemed like the better choice for us as developers. Arduino programs are normally written in C\cite{strahl2000language}, which we had little to no prior experience with. Additionally, Arduinos generally have low-powered CPUs, in order to keep them cheap. These low-powered CPUs tend to have problems with decoding MP3-files, which would lay heavy constraints on our system (without using sounds or a display, it is hard to communicate with children). Due to these facts, we choose to develop the system on a Raspberry Pi.

Our tangible user interface was planned to contain a lot of the same functionality that KAPP had, with some modifications. The reason we chose to develop on a different platform was to make the system more user friendly, specifically lower the requirement for technical knowledge needed to introduce \ab{} to an inexperienced user, by following the ``Plug and Play'' principle.
 
\section{Technology}

\subsection{Raspberry Pi - Specifications Overview}
The \rpi{} was initially intended to teach british school children about computer programming\cite{rasperrypi-about}. Since its release, it took an unexpected turn when lots of computer enthusiasts bought the product to do their own mini projects for a cheap price. 

The specification of a \rpi{} (Model B) is included in Table \ref{tab:pi-specs}. Figure \ref{fig:pi-arch-overview} shows an overview of the \rpi{}.        

\begin{table}[H]
\begin{tabular}{|p{6.0cm} | p{6.0cm} |}
\hline 
\textbf{Property} & \textbf{Specification} \\
\hline
CPU & 700 MHz ARM1176JZF-S core \\
\hline
Memory & 512 MB \\
\hline
USB 2.0 ports & 2 \\
\hline
Video Output & HDMI \\
\hline
Audio Output & 3.5 mm jack, in addition to ability to play sound through HDMI \\
\hline
Low-level Peripherals & 8 x GPIO (General Purpose Input/Output) \\
\hline
Power Source & 5 volt MicroUSB \\
\hline
Storage & SD card (available with preinstalled OS) \\
\hline
Network & 10/100 Mbps Ethernet.  \\
\hline
\end{tabular}
\caption{Raspberry Pi specifications}
\label{tab:pi-specs}
\end{table}

\begin{figure}[H] 
	\begin{minipage}[b]{0.4\linewidth}
	\centering
		\includegraphics[width=0.3\paperwidth]{Pictures/rpi-arch-overview.png}
	\caption[Raspberry Pi Model B Architecture]{Raspberry Pi Model B architecture. \emph{Image source: http://raspberrypi.org/faqs} }
	\label{fig:pi-arch-overview}
	\end{minipage}
	\hspace{2.0cm}
	\begin{minipage}[b]{0.4\linewidth}
		\centering
			\includegraphics[width=0.3\paperwidth]{Pictures/pi-fritzing-model.png}
		\caption{Digital schematic of the components}
		\label{fig:pi-fritzing}
	\end{minipage}
\end{figure}
 
  
\subsection{Additional Components}
In addition to the \rpi{} we needed some components that children are able to interact through. These components and their functionality are summarized in this section. 


\paragraph{RFID Reader}
In order to interact with \ab{}, children can register RFID-tags against \ab{}'s stomach. The RFID-reader we used was a Sparkfun ID-12LA \fnurl{Sparkfun ID-12LA documentation}{http://tiny.cc/sparkfundoc}. The requirements when choosing the reader was that it should be able to connect through an USB-port, and be able to communicate with UNIX-systems.
         
\paragraph{USB speakers}
In order to play sounds to children, we decided to integrate speakers inside AsthmaBuddy. Since we did not want to pull too many wires out of the bear, we decided to use USB-powered speakers.    

\paragraph{LED lights}
We used LED lights connected to a breadboard in order to play around with the first prototype. The LED lights emits light in different colors to correspond to what action(s) is expected from the user during a treatment (see more in \ref{sec:proto1}).
 

Figure \ref{fig:pi-fritzing} shows a digital overview of \buddy{}. The green figure to the left is our \rpi{}. While it is also connected to a power supply and an internet cable, we chose not to include these in our figure. The red figure to the right is the RFID reader. It is connected to the \rpi{} through an USB cable. The black figure on top is the speaker, connected to the \rpi{} through the audio port. 
The grey lines and the lamp represents our LED light. It is connected to three of the GPIO (General Purpose I/O) ports on the \rpi{}, through a resistor. The last leg of the LED light is connected to ground on the \rpi{}, without a resistor.

\subsection{Components Considered for Use}
A child needs to be able to interact with AsthmaBuddy. We identified two approaches; using a button and/or using RFID technology to do it. We figured that having a big button on the top of a teddy bear would seem somewhat unnatural for a child. Additionally, this could cause problems with the wires inside the teddybear, as a child pushing a button could imply that AsthmaBuddy would be moved around. This could have been avoided by using a battery pack for the \rpi{}, but their capacity does not seem to exceed 24 hours when the \rpi{} is in idle mode. The conclusion was to use RFID technology to proceed in the medication process.

[TODO: Skrive om].
[REMEMBER TO WRITE THAT THEY ARE SIMULATED BEFORE INTERACTION DESIGN (CHP 8.3.2)]
\subsection{Frameworks and Libraries Used in \ab{}} 

\paragraph{Pi4j}
We wanted to write the code on our \rpi{} in Java, as it was our most familiar programming language. However, it is cumbersome to use \rpi{}'s GPIO-ports and serial communications with Java and no frameworks. Pi4j\fnurl{Pi4j}{http://pi4j.com} solved this problem, by making the necessary abstractions.

\paragraph{Gson}
As mentioned in Chapter \ref{chp:description}, our webservice gives out JSON-formatted objects of data stored in our database. We used Google's Gson-library\fnurl{Google Gson}{https://code.google.com/p/google-gson/} to deserialize these objects into Java objects.   

\paragraph{JLayer}
We used JLayer\fnurl{Javazoom JLayer}{http://www.javazoom.net/index.shtml} to handle the decoding of our recorded mp3-files. 

\section{Design Rationale}
\subsection{Why a Teddy Bear?}
When designing \buddy{} we choose to use a teddy bear as an avator for our system. There are several reasons as to why we think this is an appropriate avatar. Teddy bears are well known toys, and has been loved for a long time. They are considered gender-neutral\cite{stagnitti1997determining}\cite{cherney2006gender} and in our subjective opinion it is a toy that could be discretely placed in a children's room. With the look of a teddy bear, \buddy{} can easily be placed among other toys and not be too visible. It was also important for us to choose a teddy bear of some size. A too thin bear could lead to problems with fitting the system inside the bear, and could in order lead to scepticism from the children. \buddy{} will have similarities to Tamagotchi\cite{tamagotchi} and Furby\cite{furby}, but \buddy{}'s purpose is to motivate, instruct and learn children about asthma, not being a toy meant purely for play. 

While designing our system we also wanted to make sure our system did not have robot-like features or robotic similarities. While children tend to find technology very interesting, we want to make \buddy{} seem as natural as possible, making a stuffed animal buddy, rather than a technological toy. We believe that these design choices serves our purpose of making children more aware of their asthma, while not being a constant reminder and a stress element. 

Norwegian fire fighters have used a teddy bear in order to calm down children who find themselves in dramatic situations \fnurl{NRK: Firefighters use teddy bears to calm down children}{http://www.nrk.no/trondelag/bamser-i-utrykningsbilene-1.11548966}. The fire fighters state that the children respond positively to the teddy bear. 
While we were not able to find scientific research done on the use of teddy bears in dramatic situations, we found this news article interesting and a relevant mention to our research. 

A teddy bear has also been used as an avatar for giving instructions on how to apply a treatment correctly. Glaxo Smith Kline, a leading company within consumer health care uses a teddy bear in their instruction manual for the use of asthma medicine and the breathing chamber\cite{glaxosmithkline}. 

Included below is two pictures of how \ab{} looks in its final form. 

\begin{figure}[H] 
	\begin{minipage}[t]{0.4\linewidth}
	\centering
		\includegraphics[width=0.3\paperwidth]{Pictures/abandinhaler.jpg}
	\caption[AsthmaBuddy holding a mask and an inhaler]{AsthmaBuddy holding a mask and an inhaler}
	\label{fig:asthmabuddyandinhaler}
	\end{minipage}
	\hspace{2.0cm}
	\begin{minipage}[t]{0.4\linewidth}
		\centering
			\includegraphics[width=0.3\paperwidth]{Pictures/abbluelight.jpg}
		\caption{AsthmaBuddy with his nose light turned on}
		\label{fig:asthmabuddyandlightnose}
	\end{minipage}
\end{figure}


\subsection{Interaction design}
\label{sec:interactiondesign}
When we started developing the interaction design of \buddy{}, we had a brainstorming session with the intentions of coming up with reasonable interaction patterns.        
By ``reasonable'', we imply that the underlying functionality should be relatively cheap to implement. The interactions should also be fun for the children to perform, in addition to being efficient.  

\begin{table}[H]
	\begin{tabular}{| p{3.0cm} | p{5.5cm} | p{5.5cm} |}
		\hline
		\textbf{Interaction Process} & \textbf{Rationale} & \textbf{Possible implementation} \\
		\hline
		Give \buddy{} a ``High five'' & Demonstrates to children that \buddy{} is friendly. It is intended that a child should keep \buddy{}'s arm up, and high five \buddy{} with the other arm. & A gyroscope and a preassure sensor combined could verify that a high five has been received. \\
		\hline
		Hold \buddy{}'s hand & Demonstrates to children that \buddy{} is friendly. & Preassure sensor within the hand of \buddy{} could solve this. \\
		\hline
		Hold smartphone close to AsthmaBuddy's belly & Could demonstrate the ``smartness'' of \buddy{}, i.e. it can communicate with other things. & Could be solved by Bluetooth. \\
		\hline 
		Press \buddy{}'s nose & Demonstrates to children that \buddy{} is friendly. & Preassure sensor within the nose of \buddy{} could solve this. \\
		\hline
		Press \buddy{}'s belly & Same as above. & Same as above. \\
		\hline
		Hold medicine close to \buddy{}'s mouth & Demonstrates that \buddy{} also needs his medicine. & An RFID-tag attached to the medicine, and an RFID-reader inside the nose of \buddy{} could be used here to control the flow. \\ 
		\hline
		Hold RFID-tag close to \buddy{}'s mouth & Is a relatively easy way to proceed with the process. & A loose RFID-tag could be used together with an integrated RFID-reader, in order to proceed. \\ 
		\hline
		Hold RFID-tag close to \buddy{}'s belly & Same as above. & Same as above. \\
		\hline
		Clap your hands & Should be a fun way of interacting with systems, considering the age of our target group. & Sound recognition could be used here. \\ 
		\hline
	\end{tabular}
	\label{tab:interaction-rationale}
	\caption{Rationale behind \buddy{}'s interaction design}
\end{table}

\subsection{Answering to Champoux's Development Framework}
\label{sec:answeringchampoux}
In Section \ref{sec:champoux} we described the development framework presented by Champoux \etal{}. When developing \buddy{}, we tried to answer the proposed questions that we considered relevant. 

\textbf{BO1: What should the user experience?}
The user should experience an interactive guide to applying an asthma treatment correctly. \buddy{} should give correct information in an understandable manner. 


\textbf{BO2: What are the human tasks?}
\begin{itemize}
  \item Fetch an adult
  \item Fetch inhaler and mask
  \item Shake medicine
  \item Attach the inhaler to the mask
  \item Put the mask around your mouth
\end{itemize}

\textbf{BO3: What should the artefact represent and control?}
\buddy{} represents a caregiver, who supervises children during their treatment. The artefact controls that children take their medicine at the correct time, and in a correct manner.   

\textbf{BO4: What are the conventions?}
Children have their inhaler and mask stored within a short distance of \buddy{}. Their RFID-tags are attached on their inhalers.    

\textbf{OC5a: What is the nature of the interaction for each sub task (Continuous vs Discrete vs Assembly)?}
The subtasks performed when taking a medicine is the following:
\begin{enumerate}
  \item Fetch parents
  \item Fetch inhaler
  \item Fetch mask
  \item Prepare medicine
  	\begin{enumerate}
  	  \item Shake the inhaler
  	  \item Attach inhaler to the mask
  	 \end{enumerate}
  \item Inhale dosage
  	\begin{enumerate}
  	  \item Hold medicine towards mouth
  	  \item Press the inhaler
  	  \item Breathe heavily for 10 seconds
  	 \end{enumerate}
  \item Optional, depending on the medicine: Rinse mouth
\end{enumerate}

Step 4 is an assembly task, 5(c) is a continuous task for a short period of time, while the remaining tasks are all discrete.  

\textbf{OC6: Does the sub-task need any relational interaction?}
None of the sub-tasks needs relational interaction.
[Pieter: Vil RFID-tag og RFID-leser her telle som en form for relational interaction?]
 
\subsection{Dealing with Bellotti's challenges}

Section \ref{sec:challenges-with-TUI} introduced some of the challenges that are exposed when designing tangible interfaces. Here, we'll discuss how we intend to handle the challenges presented, by answering his questions that we found relevant. 

\textbf{Address: How do I address one of many possible devices?}
One of the challenges mentioned here is ``How to not address the system''. This is an interesting challenge when the system is intended for children, as they are likely to pick things up and carry them around. If a child picks up \ab{}, it could be interpreted as an interaction. We solved this potential problem by only starting treatments in one of two ways, either by an alarm firing or an RFID-tag attached to an inhaler is read by \ab{}. The RFID-reader is only capable of reading within a distance of 3-5 cm. Thus, as long as no alarms is fired, and an inhaler with attached RFID-tag is not withing the reach of the RFID-reader, the system should not respond.  

\textbf{Attention: How do I know the system is ready and attending to my actions?}
As mentioned previously, \buddy{} has a LED-light on it's nose. When the light is green, the user can expect that the system is running in idle mode. 

\textbf{Action: How do I effect a meaningful action, control its extent and possibly specify a target or targets for my action?}
The part that regards specifying a target or several targets is considered irrelevant. The interesting part is how the user can effect a meaningful action and control its extent. This will be taken care of by interactions between the user and \buddy{}. \buddy{} will never run several instructions at once. It will always give short and clear instructions, and wait for feedback from the user in order to proceed. 

\textbf{Alignment: How do I know the system is doing the right thing?}
By listening when \buddy{} speaks, the user should be aware of what is going on. There is not a lot of room for human errors here. By following the normal sequence of operation, the worst thing that can happen is a system crash. This will be handled by shutting down the lights, and \buddy{} will not be running.  

\textbf{Accident: How do I avoid mistakes?}
Again, as long as the user is paying attention to what \buddy{} says, and does the intended interaction. A part of the challenge here is to recover from mistakes that has happened. For instance, if the user goes further proceeds further than was actually intended, and missed out on an instruction they needed, \buddy{} should have a way to go back to missed instruction. This was handled by having a separate ``back''-interaction method.
[TODO: Finn en interaksjon som kaller Back].   

\input{Chapters/asthmabuddy/asthmabuddy-system-overview.tex}
 

\section{Prototype version 1}
\label{sec:proto1}
Our first prototype was a ``dumb'' version with the purpose of testing out different methods of interaction. We wanted to get as many different experiences as possible, in order to find which methods of interaction will work with \ab{}. We did not have the time to implement all of the interaction methods listed. In order to simulate the interactions we used the Wizard-of-Oz technique\cite{wilson1988rapid}. 

For the first prototype we tried out the following types of interaction with AsthmaBuddy:
\begin{enumerate}
	\item{Give AsthmaBuddy a ``High Five''}
	\item{Hold AsthmaBuddy's hand}
	\item{Hold smartphone close to AsthmaBuddy's belly}
	\item{Press AsthmaBuddy's nose}
	\item{Press \buddy{}'s belly}
	\item{Hold medicine close to AsthmaBuddy's mouth}
	\item{Hold RFID-tag close to \buddy{}'s nose}
	\item{Hold RFID-tag close to \buddy{}'s belly}
	\item{Clap your hands}
	\item{A variation of the above interactions}
\end{enumerate}


\subsection{Evaluation of prototype version 1}

\paragraph{Evaluation of interaction methods}
\label{chp:interaction-methods}
\begin{table}[H]
\begin{tabular}{|p{5.0cm} | p{6.0cm} | p{3.0cm} |}
\hline 
\textbf{Interaction Method} & \textbf{Comments} & \textbf{Will it be in version 2?}\\
\hline
	Give AsthmaBuddy a ``High Five'' & Worked out fine. A high five is cool and may make \ab{} seem more friendly to the children. & Yes \\
\hline
	Hold AsthmaBuddy's hand & Easy to understand and use during a treatment. Should give feedback to indicate that the user has interacted correctly. & Yes\\
\hline
	Hold smartphone close to AsthmaBuddy's belly & Smart phones are cool, but may be easily damaged if lost on the ground. To risky to let small children handle the smart phone. The size of smart phones may require use of two hands, which may cause complications for the children. & No \\
\hline
	Press AsthmaBuddy's nose & Users tended to press the LED light on the nose. Risk of damage to light. & No\\
\hline
	Press \buddy{}'s belly & Easy to understand and use during a treatment. Should give feedback to indicate that the user has interacted correctly. & Yes\\
\hline
	Hold medicine close to AsthmaBuddy's mouth & Created some complications when the user was supposed to hold the mask to his/her mouth and then hold the medicine close to \ab{}'s mouth to proceed. & No \\
\hline
	Hold RFID-chip close to \buddy{}'s nose & The thickness of \buddy{}'s nose made it difficult for the RFID tag to communicate with our reader, this caused problems for the user. & No \\
\hline
	Hold RFID-chip close to \buddy{}'s belly & Works OK. Letting children have their ``magic token'' which interacts with \ab{} may be cool for them. & Yes\\
\hline
	Clap your hands & Worked out OK. At one point the user has to clap hands when having the mask in his/her hands, which may cause some problems, but should not be a big problem. & Yes\\
\hline
	A variation of the above interactions & Confusing for users. The confusion may take the fun out of it & May be considered in a revised form.\\
\hline
\end{tabular}
\caption{Evaluation of interaction methods for AsthmaBuddy}
\label{tab:interactioneval}
\end{table}

\paragraph{Operating time}
The longest duration for taking a planned treatment was about 2 minutes for an experienced user, and about 2.5 minutes for an inexperienced user. This treatment included the part where \buddy{} completes the treatment before the child. A normal treatment taken without \ab{} usually takes 1-2 minutes, according to our interview subjects. Since \ab{} only takes 0.5-1.5 minutes longer than normal, it should not be considered a time-waster. From another point-of-view, if a child does not want to take his/her medication, it may cause an argument and take more time to complete the treatment. If \ab{} can help on shortening the time spent arguing with the children, a huge amount of time may be saved.      

\paragraph{Feedback}
We got some feedback regarding the \emph{by need} treatments. Some parents stated that they would not use \buddy{} to complete a by need treatment, as their child was suffering from an asthma attack. However, one of the parents noted that if children were grown custom to performing their treatment with \buddy{}, it could create a dependency toward it, i.e. \buddy{} could help the child to calm down. Whether or not the by need functionality would actually be used needs more research, as \buddy{} would need to be placed within a home and be nearby when such an attack occurs. 

In order for \ab{} to be useful for inexperienced users, it could have even clearer and more informative instructions. Even though it may seem self-explanatory to take the cap off the medicine before mounting it on the mask, it may not be that obvious to new users. Since \ab{}'s purpose is to instruct and inform, it should have a completely ``foolproof'' instructions. For instance some of the test users tried to attach the inhaler to the mask without removing the protective cap from the inhaler. Since the mask's mount is made from rubber, it gave them the idea that you should just push the medicine into the mount by force, which is incorrect. 

When using \ab{} it may sometimes be difficult to hear all the instructions. There should be support for replay of latest command.

One of the users commented that \ab{} should be able to operate as a stand-alone system if the parents do not allow the children to borrow a smart phone and the child does not have a smart phone of his/her own. The same test user commented that she would not take the time to use \ab{} for two minutes every time the child needed to take a treatment, and that \ab{} might become boring after a period of time. 


	
\section{Prototype version 2}
\label{sec:abversion2}
The improved version of \ab{}, named \ab{} 2.0, had some changes done since version 1.0. As stated in Table \ref{tab:interactioneval}, some of the interaction methods were removed. \ab{} also received some new features, such as a method for letting children more easily check the amount of stars they have gathered. By registering an RFID tag, \ab{} tells how many stars the child has. This was implemented to make \ab{} more of a stand-alone system, and to avoid the problem were parents may not want the children to use their smart phone to use \app{}. 

\ab{} 2.0 now synchronizes achieved stars automatically between \app{} and \ab{}. This was done to automate some tasks that previously needed manual interaction, and to create a tighter coupling between the two prototypes. 

Some small changes was made to the use of the LED light on \ab{}'s nose. \ab{} 1.0 changed the color of its nose fairly often. This was intended to make the treatment process more interesting; however, it ended up being more confusing than helpful, and was therefore changed. 


\section{Evaluation of \ab{}}


 
